<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Visor Leaflet Málaga con GeoJSON</title>

  <!-- Leaflet CSS y JS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <!-- Plugin Geocoder para buscar direcciones -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.css" />
  <script src="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js"></script>

  <style>
    /* El mapa ocupa toda la ventana del navegador */
    #map { height: 100vh; }
  </style>
</head>
<body>

<div id="map"></div>

<script>
  // 1️⃣ Crear el mapa y centrarlo en Málaga
  var map = L.map('map').setView([36.7213, -4.4214], 13);

  // 2️⃣ Añadir capa base OpenStreetMap
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '© OpenStreetMap'
  }).addTo(map);

  // 3️⃣ Añadir buscador de direcciones
  L.Control.geocoder({ defaultMarkGeocode: true }).addTo(map);

var capasGeoJSON = {}; // Almacén de capas para poder seleccionar o deseleccionar
var capasCargadas = 0;
var totalCapas = 5;
  
  // 4️⃣ Cargar y mostrar GeoJSON
// ZBE
fetch('zbe.geojson')
  .then(res => res.json())
  .then(data => {
    capasGeoJSON["Zona de Bajas Emisiones"] = L.geoJSON(data, {
      style: {
        color: 'rgb(0, 0, 255)',
        weight: 2,
        fillOpacity: 0.3
      },
      onEachFeature: function(feature, layer) {
        layer.bindPopup(feature.properties.NOMBRE || "Zona de Bajas Emisiones");
      }
    });

    capasGeoJSON["Zona de Bajas Emisiones"].addTo(map);
    capasCargadas++;

    if (capasCargadas === totalCapas) {
      L.control.layers(null, capasGeoJSON, {
        collapsed: false
      }).addTo(map);
    }
  });

// ZEP Centro
fetch('zepcen.geojson')
  .then(res => res.json())
  .then(data => {
    capasGeoJSON["Zona de Especial Protección Centro"] = L.geoJSON(data, {
      style: {
        color: 'rgb(220, 59, 44)',
        weight: 2,
        fillOpacity: 0.3
      },
      onEachFeature: function(feature, layer) {
        layer.bindPopup(feature.properties.NOMBRE || "Zona de Especial Protección Centro");
      }
    });
    capasGeoJSON["Zona de Especial Protección Centro"].addTo(map);
    capasCargadas++;

    if (capasCargadas === totalCapas) {
      L.control.layers(null, capasGeoJSON, {
        collapsed: false
      }).addTo(map);
    }
  });

// ZEP CAC
fetch('zepcac.geojson')
  .then(res => res.json())
  .then(data => {
    capasGeoJSON["Zona de Especial Protección CAC"] = L.geoJSON(data, {
      style: {
        color: 'rgb(129, 28, 69)',
        weight: 2,
        fillOpacity: 0.3
      },
      onEachFeature: function(feature, layer) {
        layer.bindPopup(feature.properties.NOMBRE || "Zona de Especial Protección CAC");
      }
    });
    capasGeoJSON["Zona de Especial Protección CAC"].addTo(map);
    capasCargadas++;

    if (capasCargadas === totalCapas) {
      L.control.layers(null, capasGeoJSON, {
        collapsed: false
      }).addTo(map);
    }
  });

// ZEP SOHO
fetch('zepsoh.geojson')
  .then(res => res.json())
  .then(data => {
    capasGeoJSON["Zona de Especial Protección SOHO"] = L.geoJSON(data, {
      style: {
        color: 'rgb(221, 79, 136)',
        weight: 2,
        fillOpacity: 0.3
      },
      onEachFeature: function(feature, layer) {
        layer.bindPopup(feature.properties.NOMBRE || "Zona de Especial Protección SOHO");
      }
    });
    capasGeoJSON["Zona de Especial Protección SOHO"].addTo(map);
    capasCargadas++;

    if (capasCargadas === totalCapas) {
      L.control.layers(null, capasGeoJSON, {
        collapsed: false
      }).addTo(map);
    }
  });

// SARE
fetch('SARE.geojson')
  .then(res => res.json())
  .then(data => {
    capasGeoJSON["SARE"] = L.geoJSON(data, {
      style: {
        color: 'rgb(102, 115, 229)',
        weight: 2,
        fillOpacity: 0.3
      },
      onEachFeature: function(feature, layer) {
        layer.bindPopup(feature.properties.NOMBRE || "SARE");
      }
    });
    capasGeoJSON["SARE"].addTo(map);
    capasCargadas++;

    if (capasCargadas === totalCapas) {
      L.control.layers(null, capasGeoJSON, {
        collapsed: false
      }).addTo(map);
    }
  }); 

</script>

</body>
</html> 


